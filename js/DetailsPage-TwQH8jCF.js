import{E as $}from"./base-BRrwqkEg.js";import{E as g,a as j}from"./el-message-DSEjY1Pv.js";import{E as U}from"./el-button-w8vQtEkU.js";import{E as z}from"./el-divider-BHUURyVZ.js";import{_ as G,u as H,r as c,o as J,a as u,d as e,w as n,t as a,b as s,g as p,F as S,h as K,e as w,f as O,k as r,l as W,p as X,j as m}from"./index-BWPHe3CG.js";import{u as Y}from"./cartStore-BrIJIP-9.js";import{r as Z}from"./request-CbSIBlHh.js";import{E as ee}from"./el-overlay-B5Q1yc8L.js";import"./index-uMH3zwTA.js";import"./aria-Dcom87Zv.js";import"./use-global-config-Bdzg8_5z.js";import"./use-form-common-props-DbweM7ee.js";import"./index-Ci2nZ6dO.js";import"./event-BB_Ol6Sd.js";import"./focus-trap-DX4vIPMs.js";import"./error-Cq9Fpw4b.js";import"./vnode-DudMcPSu.js";const te={key:0,class:"loading"},se={key:1,class:"error"},oe={key:2,class:"production-detail"},le=["src","alt"],ne={class:"price"},ae={class:"desc"},re={class:"spec"},ue={key:0,class:"spec-selector"},ie={class:"quantity-control"},de={__name:"DetailsPage",props:{id:{type:[String,Number],required:!0,validator:v=>!isNaN(v)||typeof v=="string"}},setup(v){const y=X(),C=Y(),I=H(),h=c(!0),k=c(null),l=c(0),b=c(100),o=c(null),E=c(!1),N=v,F=async()=>{const _=parseInt(N.id);try{h.value=!0,k.value=null;const t=await Z({method:"get",url:"/api/productions",params:{id:_}});t.success&&(E.value=!0,o.value=t.production)}catch{g.error("商品信息加载失败，请稍后重试"),y.push("/404")}finally{h.value=!1}},q=()=>{if(l.value<=0){g.warning("请选择商品规格！");return}const _={...o.value,specs:o.value.specs[0],quantity:l.value,stock:o.value.stock,unit:o.value.unit};I.isLoggedIn?(C.addItem(_),g.success(`已成功添加 ${l.value} ${o.value.unit} ${o.value.name} 到购物车`),l.value=0):ee.confirm("请先登录！！！","去登录",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{y.push("/Login")}).catch(()=>{g.info("已取消登录")})},M=()=>{l.value>0&&l.value--},P=()=>{l.value++,l.value<b&&l.value++};J(()=>{F()});const T=()=>{y.push("/ShoppingCart")};return(_,t)=>{const x=m("star-filled"),i=$,d=z,A=m("Minus"),f=U,D=m("Plus"),V=m("ArrowRightBold"),L=m("ShoppingCartFull"),Q=j;return r(),u(S,null,[e(d,null,{default:n(()=>[e(i,null,{default:n(()=>[e(x)]),_:1})]),_:1}),e(d,{"border-style":"dashed"}),h.value?(r(),u("div",te,"加载中...")):k.value?(r(),u("div",se,a(k.value),1)):(r(),u("div",oe,[s("h1",null,a(o.value.name),1),s("img",{src:o.value.image,alt:o.value.name},null,8,le),s("p",ne,[t[0]||(t[0]=s("span",null,"价格:",-1)),p("￥"+a(o.value.price.toFixed(2))+" ",1),s("span",null,"元/"+a(o.value.unit),1)]),s("p",ae,a(o.value.description),1),e(d,{"border-style":"dashed"}),s("div",re,[t[1]||(t[1]=s("h3",null,"规格参数",-1)),s("ul",null,[(r(!0),u(S,null,K(o.value.specs[0],(R,B)=>(r(),u("li",{key:B},[s("span",null,a(B)+": ",1),p(a(R),1)]))),128))])]),e(d,{"border-style":"dashed"}),o.value.specs?(r(),u("div",ue,[t[6]||(t[6]=s("h3",null,"选择规格",-1)),s("div",ie,[e(f,{disabled:l.value===0,onClick:M,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(A)]),_:1})]),_:1},8,["disabled"]),s("span",null,[t[2]||(t[2]=p("已选择:")),s("strong",null,a(l.value),1)]),e(f,{disabled:l.value>b.value,onClick:P,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(D)]),_:1})]),_:1},8,["disabled"])]),s("div",null,[s("span",null,[t[3]||(t[3]=p("共计:")),s("strong",null,"¥"+a((l.value*o.value.price).toFixed(2)),1),t[4]||(t[4]=p("元"))])]),e(f,{type:"success",onClick:q,round:""},{default:n(()=>[t[5]||(t[5]=p("加入购物车")),e(i,null,{default:n(()=>[e(V)]),_:1})]),_:1})])):w("",!0)])),e(d,{"border-style":"dotted"}),e(Q,{value:O(C).totalItems},{default:n(()=>[E.value?(r(),W(f,{key:0,title:"购物车",onClick:T,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(L)]),_:1})]),_:1})):w("",!0)]),_:1},8,["value"]),e(d,null,{default:n(()=>[e(i,null,{default:n(()=>[e(x)]),_:1})]),_:1})],64)}}},Ie=G(de,[["__scopeId","data-v-aa65ad6d"]]);export{Ie as default};
