import{E as $}from"./base-BrLvHeEz.js";import{E as g,a as j}from"./el-message-CDeRKx3U.js";import{E as U}from"./el-button-CtCx0wzE.js";import{E as z}from"./el-divider-FMxkWxWL.js";import{_ as G,u as H,r as d,o as J,a as u,d as e,w as n,t as a,b as s,n as p,F as S,g as K,e as w,f as O,j as r,k as W,p as X,i as m}from"./index-BJ8CMOzX.js";import{u as Y}from"./cartStore-DP79hyFq.js";import{r as Z}from"./request-D62Ehise.js";import{E as ee}from"./el-overlay-BMqcU0d2.js";import"./index-BRO3r1ed.js";import"./aria-Dcom87Zv.js";import"./use-global-config-lAPLHJ-8.js";import"./use-form-common-props-0hT0vvR3.js";import"./index-DD6m2SLq.js";import"./event-BB_Ol6Sd.js";import"./focus-trap-CbSkDzOF.js";import"./error-Cq9Fpw4b.js";import"./vnode-Th6H0zNw.js";const te={key:0,class:"loading"},se={key:1,class:"error"},oe={key:2,class:"production-detail"},le=["src","alt"],ne={class:"price"},ae={class:"desc"},re={class:"spec"},ue={key:0,class:"spec-selector"},ie={class:"quantity-control"},ce={__name:"DetailsPage",props:{id:{type:[String,Number],required:!0,validator:_=>!isNaN(_)||typeof _=="string"}},setup(_){const y=X(),b=Y(),I=H(),h=d(!0),k=d(null),l=d(0),C=d(100),o=d(null),E=d(!1),N=_,F=async()=>{const v=parseInt(N.id);try{h.value=!0,k.value=null;const t=await Z({method:"get",url:"/api/productions",params:{id:v}});t.success&&(E.value=!0,o.value=t.production)}catch{g.error("商品信息加载失败，请稍后重试"),y.push("/404")}finally{h.value=!1}},q=()=>{if(l.value<=0){g.warning("请选择商品规格！");return}const v={...o.value,specs:o.value.specs[0],quantity:l.value,stock:o.value.stock,unit:o.value.unit};I.isLoggedIn?(b.addItem(v),g.success(`已成功添加 ${l.value} ${o.value.unit} ${o.value.name} 到购物车`),l.value=0):ee.confirm("请先登录！！！","去登录",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{y.push("/Login")}).catch(()=>{g.info("已取消登录")})},M=()=>{l.value>0&&l.value--},P=()=>{l.value++,l.value<C&&l.value++};J(()=>{F()});const T=()=>{y.push("/ShoppingCart")};return(v,t)=>{const x=m("star-filled"),i=$,c=z,A=m("Minus"),f=U,D=m("Plus"),V=m("ArrowRightBold"),L=m("ShoppingCartFull"),Q=j;return r(),u(S,null,[e(c,null,{default:n(()=>[e(i,null,{default:n(()=>[e(x)]),_:1})]),_:1}),e(c,{"border-style":"dashed"}),h.value?(r(),u("div",te,"加载中...")):k.value?(r(),u("div",se,a(k.value),1)):(r(),u("div",oe,[s("h1",null,a(o.value.name),1),s("img",{src:o.value.image,alt:o.value.name},null,8,le),s("p",ne,[t[0]||(t[0]=s("span",null,"价格:",-1)),p("￥"+a(o.value.price.toFixed(2)),1)]),s("p",ae,a(o.value.description),1),e(c,{"border-style":"dashed"}),s("div",re,[t[1]||(t[1]=s("h3",null,"规格参数",-1)),s("ul",null,[(r(!0),u(S,null,K(o.value.specs[0],(R,B)=>(r(),u("li",{key:B},[s("span",null,a(B)+": ",1),p(a(R),1)]))),128))])]),e(c,{"border-style":"dashed"}),o.value.specs?(r(),u("div",ue,[t[6]||(t[6]=s("h3",null,"选择规格",-1)),s("div",ie,[e(f,{disabled:l.value===0,onClick:M,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(A)]),_:1})]),_:1},8,["disabled"]),s("span",null,[t[2]||(t[2]=p("已选择:")),s("strong",null,a(l.value),1)]),e(f,{disabled:l.value>C.value,onClick:P,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(D)]),_:1})]),_:1},8,["disabled"])]),s("div",null,[s("span",null,[t[3]||(t[3]=p("共计:")),s("strong",null,"¥"+a((l.value*o.value.price).toFixed(2)),1),t[4]||(t[4]=p("元"))])]),e(f,{type:"success",onClick:q,round:""},{default:n(()=>[t[5]||(t[5]=p("加入购物车")),e(i,null,{default:n(()=>[e(V)]),_:1})]),_:1})])):w("",!0)])),e(c,{"border-style":"dotted"}),e(Q,{value:O(b).totalItems},{default:n(()=>[E.value?(r(),W(f,{key:0,title:"购物车",onClick:T,circle:""},{default:n(()=>[e(i,null,{default:n(()=>[e(L)]),_:1})]),_:1})):w("",!0)]),_:1},8,["value"]),e(c,null,{default:n(()=>[e(i,null,{default:n(()=>[e(x)]),_:1})]),_:1})],64)}}},Ie=G(ce,[["__scopeId","data-v-cbbf252d"]]);export{Ie as default};
