import{b as z,f as Q,i as T,g as U,h as K,u as q,_ as M,w as J,c as W,d as L,E as pe}from"./base-FLaoZt01.js";import{u as me,E as fe}from"./el-button-CRAMnhDp.js";import{E as ve}from"./el-card-Cg0FEuLN.js";import{E as _e,a as ye}from"./el-descriptions-item-DYBu0AtH.js";/* empty css               */import{u as be}from"./cartStore-BMC-uKOJ.js";import{H,r as P,N as ge,c as y,J as k,j as h,a as S,b as s,m as Y,Y as Z,f as e,Z as X,z as b,y as O,M as N,B as ee,n as I,t as E,A as ae,o as te,G as he,O as Se,$ as we,s as Ee,a0 as Ie,e as G,_ as ke,x as Ve,d as g,w as _,p as Be,F as Ce,g as $e}from"./index-Bcu1wmac.js";import{u as Pe}from"./adminStore-tOVbcO9_.js";import{E as $}from"./el-message-BwHjNfu0.js";import{E as Ne}from"./index-Bro3KYmG.js";import{U as j,C as x}from"./event-BB_Ol6Sd.js";import{a as Re,b as Ge,c as ze,d as De,e as Fe}from"./use-form-common-props-aUHwGn2-.js";import{u as Oe}from"./index-CW4qdgPr.js";import{d as qe}from"./error-Cq9Fpw4b.js";import"./use-global-config-7ehr_DJ7.js";import"./vnode-BZtwkAGT.js";import"./index-BOEJgLbD.js";import"./aria-Dcom87Zv.js";const oe=z({modelValue:{type:[String,Number,Boolean],default:void 0},size:Q,disabled:Boolean,label:{type:[String,Number,Boolean],default:void 0},value:{type:[String,Number,Boolean],default:void 0},name:{type:String,default:void 0}}),Me=z({...oe,border:Boolean}),se={[j]:i=>H(i)||T(i)||U(i),[x]:i=>H(i)||T(i)||U(i)},le=Symbol("radioGroupKey"),re=(i,m)=>{const u=P(),t=ge(le,void 0),n=y(()=>!!t),o=y(()=>K(i.value)?i.label:i.value),c=y({get(){return n.value?t.modelValue:i.modelValue},set(r){n.value?t.changeEvent(r):m&&m(j,r),u.value.checked=i.modelValue===o.value}}),f=Re(y(()=>t==null?void 0:t.size)),l=Ge(y(()=>t==null?void 0:t.disabled)),p=P(!1),v=y(()=>l.value||n.value&&c.value!==o.value?-1:0);return me({from:"label act as value",replacement:"value",version:"3.0.0",scope:"el-radio",ref:"https://element-plus.org/en-US/component/radio.html"},y(()=>n.value&&K(i.value))),{radioRef:u,isGroup:n,radioGroup:t,focus:p,size:f,disabled:l,tabIndex:v,modelValue:c,actualValue:o}},Te=k({name:"ElRadio"}),je=k({...Te,props:Me,emits:se,setup(i,{emit:m}){const u=i,t=q("radio"),{radioRef:n,radioGroup:o,focus:c,size:f,disabled:l,modelValue:p,actualValue:v}=re(u,m);function r(){ee(()=>m(x,p.value))}return(w,d)=>{var a;return h(),S("label",{class:b([e(t).b(),e(t).is("disabled",e(l)),e(t).is("focus",e(c)),e(t).is("bordered",w.border),e(t).is("checked",e(p)===e(v)),e(t).m(e(f))])},[s("span",{class:b([e(t).e("input"),e(t).is("disabled",e(l)),e(t).is("checked",e(p)===e(v))])},[Y(s("input",{ref_key:"radioRef",ref:n,"onUpdate:modelValue":V=>X(p)?p.value=V:null,class:b(e(t).e("original")),value:e(v),name:w.name||((a=e(o))==null?void 0:a.name),disabled:e(l),checked:e(p)===e(v),type:"radio",onFocus:V=>c.value=!0,onBlur:V=>c.value=!1,onChange:r,onClick:O(()=>{},["stop"])},null,42,["onUpdate:modelValue","value","name","disabled","checked","onFocus","onBlur","onClick"]),[[Z,e(p)]]),s("span",{class:b(e(t).e("inner"))},null,2)],2),s("span",{class:b(e(t).e("label")),onKeydown:O(()=>{},["stop"])},[N(w.$slots,"default",{},()=>[I(E(w.label),1)])],42,["onKeydown"])],2)}}});var xe=M(je,[["__file","radio.vue"]]);const Ae=z({...oe}),Ue=k({name:"ElRadioButton"}),Ke=k({...Ue,props:Ae,setup(i){const m=i,u=q("radio"),{radioRef:t,focus:n,size:o,disabled:c,modelValue:f,radioGroup:l,actualValue:p}=re(m),v=y(()=>({backgroundColor:(l==null?void 0:l.fill)||"",borderColor:(l==null?void 0:l.fill)||"",boxShadow:l!=null&&l.fill?`-1px 0 0 0 ${l.fill}`:"",color:(l==null?void 0:l.textColor)||""}));return(r,w)=>{var d;return h(),S("label",{class:b([e(u).b("button"),e(u).is("active",e(f)===e(p)),e(u).is("disabled",e(c)),e(u).is("focus",e(n)),e(u).bm("button",e(o))])},[Y(s("input",{ref_key:"radioRef",ref:t,"onUpdate:modelValue":a=>X(f)?f.value=a:null,class:b(e(u).be("button","original-radio")),value:e(p),type:"radio",name:r.name||((d=e(l))==null?void 0:d.name),disabled:e(c),onFocus:a=>n.value=!0,onBlur:a=>n.value=!1,onClick:O(()=>{},["stop"])},null,42,["onUpdate:modelValue","value","name","disabled","onFocus","onBlur","onClick"]),[[Z,e(f)]]),s("span",{class:b(e(u).be("button","inner")),style:ae(e(f)===e(p)?e(v):{}),onKeydown:O(()=>{},["stop"])},[N(r.$slots,"default",{},()=>[I(E(r.label),1)])],46,["onKeydown"])],2)}}});var ne=M(Ke,[["__file","radio-button.vue"]]);const Le=z({id:{type:String,default:void 0},size:Q,disabled:Boolean,modelValue:{type:[String,Number,Boolean],default:void 0},fill:{type:String,default:""},textColor:{type:String,default:""},name:{type:String,default:void 0},validateEvent:{type:Boolean,default:!0},...Oe(["ariaLabel"])}),He=se,Qe=k({name:"ElRadioGroup"}),Je=k({...Qe,props:Le,emits:He,setup(i,{emit:m}){const u=i,t=q("radio"),n=ze(),o=P(),{formItem:c}=De(),{inputId:f,isLabeledByFormItem:l}=Fe(u,{formItemContext:c}),p=r=>{m(j,r),ee(()=>m(x,r))};te(()=>{const r=o.value.querySelectorAll("[type=radio]"),w=r[0];!Array.from(r).some(d=>d.checked)&&w&&(w.tabIndex=0)});const v=y(()=>u.name||n.value);return he(le,Se({...we(u),changeEvent:p,name:v})),Ee(()=>u.modelValue,()=>{u.validateEvent&&(c==null||c.validate("change").catch(r=>qe()))}),(r,w)=>(h(),S("div",{id:e(f),ref_key:"radioGroupRef",ref:o,class:b(e(t).b("group")),role:"radiogroup","aria-label":e(l)?void 0:r.ariaLabel||"radio-group","aria-labelledby":e(l)?e(c).labelId:void 0},[N(r.$slots,"default")],10,["id","aria-label","aria-labelledby"]))}});var ie=M(Je,[["__file","radio-group.vue"]]);const We=J(xe,{RadioButton:ne,RadioGroup:ie}),Ye=W(ie);W(ne);const Ze=z({decimalSeparator:{type:String,default:"."},groupSeparator:{type:String,default:","},precision:{type:Number,default:0},formatter:Function,value:{type:L([Number,Object]),default:0},prefix:String,suffix:String,title:String,valueStyle:{type:L([String,Object,Array])}}),Xe=k({name:"ElStatistic"}),ea=k({...Xe,props:Ze,setup(i,{expose:m}){const u=i,t=q("statistic"),n=y(()=>{const{value:o,formatter:c,precision:f,decimalSeparator:l,groupSeparator:p}=u;if(Ie(c))return c(o);if(!T(o)||Number.isNaN(o))return o;let[v,r=""]=String(o).split(".");return r=r.padEnd(f,"0").slice(0,f>0?f:0),v=v.replace(/\B(?=(\d{3})+(?!\d))/g,p),[v,r].join(r?l:"")});return m({displayValue:n}),(o,c)=>(h(),S("div",{class:b(e(t).b())},[o.$slots.title||o.title?(h(),S("div",{key:0,class:b(e(t).e("head"))},[N(o.$slots,"title",{},()=>[I(E(o.title),1)])],2)):G("v-if",!0),s("div",{class:b(e(t).e("content"))},[o.$slots.prefix||o.prefix?(h(),S("div",{key:0,class:b(e(t).e("prefix"))},[N(o.$slots,"prefix",{},()=>[s("span",null,E(o.prefix),1)])],2)):G("v-if",!0),s("span",{class:b(e(t).e("number")),style:ae(o.valueStyle)},E(e(n)),7),o.$slots.suffix||o.suffix?(h(),S("div",{key:1,class:b(e(t).e("suffix"))},[N(o.$slots,"suffix",{},()=>[s("span",null,E(o.suffix),1)])],2)):G("v-if",!0)],2)],2))}});var aa=M(ea,[["__file","statistic.vue"]]);const ta=J(aa),oa={class:"checkout-container"},sa={class:"card-header"},la={class:"production-list"},ra=["src"],na={class:"production-info"},ia={class:"amount-summary"},ua={class:"qrcode-container"},da={key:0,class:"qrcode-wrapper"},ca={key:1,class:"qrcode-wrapper"},pa={class:"countdown"},ma={__name:"CheckOut",setup(i){const m=be(),u=Be(),t=Pe(),n=P("wechat"),o=P(15*60*1e3);let c=null;const f=P(!1),l=y(()=>m.items),p=y(()=>m.totalItems),v=y(()=>m.totalPrice);y(()=>l.value.map(d=>d.name)),y(()=>l.value.map(d=>d.id)),te(()=>{c=setInterval(()=>{o.value>0?o.value-=1e3:($.error("支付超时，请重新下单"),t.recordOrders({orderId:Date.now(),totalQuantity:p.value,totalPrice:v.value,paymentMethod:n.value,orderTime:new Date().toISOString(),status:"待付款",productions:m.items.map(d=>({id:d.id,name:d.name,quantity:d.quantity,price:d.price}))}),u.push("/"))},1e3)}),Ve(()=>{clearInterval(c)});const r=async()=>{try{const d=Date.now().toString()+Math.floor(Math.random()*1e3),a=()=>new Promise(B=>{setTimeout(()=>B({code:200,data:{order_id:d,qr_code:n.value==="wechat"?"/wechat-pay-demo.jpeg":"/alipay-pay-demo.jpeg"}}),500)}),V=()=>new Promise(B=>{setTimeout(()=>B({code:200,data:{status:Math.random()<.8?"paid":"failed",paid_at:new Date().toISOString()}}),1e3)}),{data:R}=await a();if(!R)throw new Error("订单创建失败");let D=5;for(;D>0;){if((await V()).data.status==="paid")return!0;D--,await new Promise(F=>setTimeout(F,2e3))}return $.error("支付超时，请重新下单"),!1}catch(d){return console.error("支付异常:",d),$.error("支付过程中出现错误"),!1}},w=async()=>{f.value=!0;try{await r()?(t.recordOrders({orderId:Date.now(),totalQuantity:p.value,totalPrice:v.value,paymentMethod:n.value,orderTime:new Date().toISOString(),status:"待发货",productions:m.items.map(a=>({id:a.id,name:a.name,quantity:a.quantity,price:a.price}))}),m.clearCart(),$.success("支付成功！"),u.push("/ShoppingCart")):(o.value=15*60*1e3,$.error("支付失败，请重新尝试"))}catch(d){console.error(d),$.error("支付失败")}finally{f.value=!1}};return(d,a)=>{const V=Ne,R=_e,D=ye,B=ve,F=pe,A=We,ue=Ye,de=ta,ce=fe;return h(),S("div",oa,[g(B,{class:"order-card"},{header:_(()=>[s("div",sa,[a[2]||(a[2]=s("h2",null,"订单结算",-1)),g(V,{type:"success"},{default:_(()=>a[1]||(a[1]=[I("待支付")])),_:1})])]),default:_(()=>[s("div",la,[(h(!0),S(Ce,null,$e(l.value,C=>(h(),S("div",{key:C.id,class:"production-item"},[s("img",{src:C.image,class:"production-image"},null,8,ra),s("div",na,[s("h4",null,E(C.name),1),s("p",null,E(C.quantity)+" × ¥"+E(C.price),1)])]))),128))]),s("div",ia,[g(D,{column:1,borde:""},{default:_(()=>[g(R,{label:"商品总价"},{default:_(()=>[I(" ¥"+E(v.value),1)]),_:1}),g(R,{label:"运费"},{default:_(()=>a[3]||(a[3]=[I("¥0.00")])),_:1}),g(R,{label:"应付总额",class:"total-amount"},{default:_(()=>[I(" ¥"+E(v.value),1)]),_:1})]),_:1})])]),_:1}),g(B,{class:"payment-card"},{header:_(()=>a[4]||(a[4]=[s("h3",null,"选择支付方式",-1)])),default:_(()=>[g(ue,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=C=>n.value=C),class:"payment-methods"},{default:_(()=>[g(A,{value:"wechat",size:"large"},{default:_(()=>[g(F,null,{default:_(()=>a[5]||(a[5]=[s("img",{src:"/public/payment_method_img/wechat.svg",width:"12",height:"12",alt:"微信支付"},null,-1)])),_:1}),a[6]||(a[6]=I(" 微信支付 "))]),_:1}),g(A,{value:"alipay",size:"large"},{default:_(()=>[g(F,null,{default:_(()=>a[7]||(a[7]=[s("img",{src:"/public/payment_method_img/alipay.svg",width:"12",height:"12",alt:"支付宝支付"},null,-1)])),_:1}),a[8]||(a[8]=I(" 支付宝支付 "))]),_:1})]),_:1},8,["modelValue"]),s("div",ua,[n.value==="wechat"?(h(),S("div",da,a[9]||(a[9]=[s("img",{src:"/public/payment_method_img/wechat-pay-demo.jpeg",class:"qrcode-image"},null,-1),s("p",null,"微信扫一扫完成支付",-1)]))):G("",!0),n.value==="alipay"?(h(),S("div",ca,a[10]||(a[10]=[s("img",{src:"/public/payment_method_img/alipay-pay-demo.jpeg",class:"qrcode-image"},null,-1),s("p",null,"支付宝扫一扫完成支付",-1)]))):G("",!0)]),s("div",pa,[g(de,{title:"支付剩余时间",value:o.value,format:"HH:mm:ss"},null,8,["value"]),g(ce,{type:"primary",size:"large",loading:f.value,onClick:w},{default:_(()=>a[11]||(a[11]=[I(" 立即支付 ")])),_:1},8,["loading"])])]),_:1})])}}},Ra=ke(ma,[["__scopeId","data-v-0132a39c"]]);export{Ra as default};
