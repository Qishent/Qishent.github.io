import{k as m,t as re,Z as ae,l as j,_ as ce,p as ue}from"./base-BBuVGrsO.js";import{c as I,I as ie,r as L,o as k,x as K,J as de,G as le,s as N,f as F,M as fe,B as q,H as ve}from"./index-BbgOGWtc.js";import{E as te}from"./aria-Dcom87Zv.js";const pe=(e,n)=>{if(!m)return!1;const t={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(n)],o=re(e,t);return["scroll","auto","overlay"].some(r=>o.includes(r))},ke=(e,n)=>{if(!m)return;let t=e;for(;t;){if([window,document,document.documentElement].includes(t))return window;if(pe(t,n))return t;t=t.parentNode}return t};let h;const Ke=e=>{var n;if(!m)return 0;if(h!==void 0)return h;const t=document.createElement("div");t.className=`${e}-scrollbar__wrap`,t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const o=t.offsetWidth;t.style.overflow="scroll";const r=document.createElement("div");r.style.width="100%",t.appendChild(r);const c=r.offsetWidth;return(n=t.parentNode)==null||n.removeChild(t),h=o-c,h};function De(e,n){if(!m)return;if(!n){e.scrollTop=0;return}const t=[];let o=n.offsetParent;for(;o!==null&&e!==o&&e.contains(o);)t.push(o),o=o.offsetParent;const r=n.offsetTop+t.reduce((T,b)=>T+b.offsetTop,0),c=r+n.offsetHeight,u=e.scrollTop,p=u+e.clientHeight;r<u?e.scrollTop=r:c>p&&(e.scrollTop=c-e.clientHeight)}const Ee=["class","style"],me=/^on[A-Z]/,Be=(e={})=>{const{excludeListeners:n=!1,excludeKeys:t}=e,o=I(()=>((t==null?void 0:t.value)||[]).concat(Ee)),r=ie();return r?I(()=>{var c;return ae(Object.entries((c=r.proxy)==null?void 0:c.$attrs).filter(([u])=>!o.value.includes(u)&&!(n&&me.test(u))))}):I(()=>({}))},Te='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',be=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,He=e=>Array.from(e.querySelectorAll(Te)).filter(n=>ne(n)&&be(n)),ne=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},x="focus-trap.focus-after-trapped",U="focus-trap.focus-after-released",ye="focus-trap.focusout-prevented",X={cancelable:!0,bubbles:!1},Fe={cancelable:!0,bubbles:!1},J="focusAfterTrapped",Y="focusAfterReleased",he=Symbol("elFocusTrap"),D=L(),P=L(0),B=L(0);let w=0;const se=e=>{const n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const r=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||r?NodeFilter.FILTER_SKIP:o.tabIndex>=0||o===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n},Z=(e,n)=>{for(const t of e)if(!we(t,n))return t},we=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},Se=e=>{const n=se(e),t=Z(n,e),o=Z(n.reverse(),e);return[t,o]},_e=e=>e instanceof HTMLInputElement&&"select"in e,v=(e,n)=>{if(e&&e.focus){const t=document.activeElement;let o=!1;j(e)&&!ne(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),o=!0),e.focus({preventScroll:!0}),B.value=window.performance.now(),e!==t&&_e(e)&&n&&e.select(),j(e)&&o&&e.removeAttribute("tabindex")}};function G(e,n){const t=[...e],o=e.indexOf(n);return o!==-1&&t.splice(o,1),t}const Le=()=>{let e=[];return{push:o=>{const r=e[0];r&&o!==r&&r.pause(),e=G(e,o),e.unshift(o)},remove:o=>{var r,c;e=G(e,o),(c=(r=e[0])==null?void 0:r.resume)==null||c.call(r)}}},Pe=(e,n=!1)=>{const t=document.activeElement;for(const o of e)if(v(o,n),document.activeElement!==t)return},z=Le(),ge=()=>P.value>B.value,S=()=>{D.value="pointer",P.value=window.performance.now()},Q=()=>{D.value="keyboard",P.value=window.performance.now()},Ce=()=>(k(()=>{w===0&&(document.addEventListener("mousedown",S),document.addEventListener("touchstart",S),document.addEventListener("keydown",Q)),w++}),K(()=>{w--,w<=0&&(document.removeEventListener("mousedown",S),document.removeEventListener("touchstart",S),document.removeEventListener("keydown",Q))}),{focusReason:D,lastUserFocusTimestamp:P,lastAutomatedFocusTimestamp:B}),_=e=>new CustomEvent(ye,{...Fe,detail:e});let E=[];const ee=e=>{e.code===te.esc&&E.forEach(n=>n(e))},Ae=e=>{k(()=>{E.length===0&&document.addEventListener("keydown",ee),m&&E.push(e)}),K(()=>{E=E.filter(n=>n!==e),E.length===0&&m&&document.removeEventListener("keydown",ee)})},Oe=de({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[J,Y,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const t=L();let o,r;const{focusReason:c}=Ce();Ae(s=>{e.trapped&&!u.paused&&n("release-requested",s)});const u={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},p=s=>{if(!e.loop&&!e.trapped||u.paused)return;const{code:a,altKey:i,ctrlKey:d,metaKey:l,currentTarget:$,shiftKey:W}=s,{loop:M}=e,oe=a===te.tab&&!i&&!d&&!l,y=document.activeElement;if(oe&&y){const A=$,[O,R]=Se(A);if(O&&R){if(!W&&y===R){const f=_({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||(s.preventDefault(),M&&v(O,!0))}else if(W&&[O,A].includes(y)){const f=_({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||(s.preventDefault(),M&&v(R,!0))}}else if(y===A){const f=_({focusReason:c.value});n("focusout-prevented",f),f.defaultPrevented||s.preventDefault()}}};le(he,{focusTrapRef:t,onKeydown:p}),N(()=>e.focusTrapEl,s=>{s&&(t.value=s)},{immediate:!0}),N([t],([s],[a])=>{s&&(s.addEventListener("keydown",p),s.addEventListener("focusin",g),s.addEventListener("focusout",C)),a&&(a.removeEventListener("keydown",p),a.removeEventListener("focusin",g),a.removeEventListener("focusout",C))});const T=s=>{n(J,s)},b=s=>n(Y,s),g=s=>{const a=F(t);if(!a)return;const i=s.target,d=s.relatedTarget,l=i&&a.contains(i);e.trapped||d&&a.contains(d)||(o=d),l&&n("focusin",s),!u.paused&&e.trapped&&(l?r=i:v(r,!0))},C=s=>{const a=F(t);if(!(u.paused||!a))if(e.trapped){const i=s.relatedTarget;!ue(i)&&!a.contains(i)&&setTimeout(()=>{if(!u.paused&&e.trapped){const d=_({focusReason:c.value});n("focusout-prevented",d),d.defaultPrevented||v(r,!0)}},0)}else{const i=s.target;i&&a.contains(i)||n("focusout",s)}};async function H(){await q();const s=F(t);if(s){z.push(u);const a=s.contains(document.activeElement)?o:document.activeElement;if(o=a,!s.contains(a)){const d=new Event(x,X);s.addEventListener(x,T),s.dispatchEvent(d),d.defaultPrevented||q(()=>{let l=e.focusStartEl;ve(l)||(v(l),document.activeElement!==l&&(l="first")),l==="first"&&Pe(se(s),!0),(document.activeElement===a||l==="container")&&v(s)})}}}function V(){const s=F(t);if(s){s.removeEventListener(x,T);const a=new CustomEvent(U,{...X,detail:{focusReason:c.value}});s.addEventListener(U,b),s.dispatchEvent(a),!a.defaultPrevented&&(c.value=="keyboard"||!ge()||s.contains(document.activeElement))&&v(o??document.body),s.removeEventListener(U,b),z.remove(u)}}return k(()=>{e.trapped&&H(),N(()=>e.trapped,s=>{s?H():V()})}),K(()=>{e.trapped&&V(),t.value&&(t.value.removeEventListener("keydown",p),t.value.removeEventListener("focusin",g),t.value.removeEventListener("focusout",C),t.value=void 0)}),{onKeydown:p}}});function Re(e,n,t,o,r,c){return fe(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ve=ce(Oe,[["render",Re],["__file","focus-trap.vue"]]);export{Ve as E,he as F,ke as a,Ke as g,ne as i,He as o,De as s,v as t,Be as u};
