import{_ as V,u as N,r as a,a as f,b as s,y as A,m,V as D,W as C,z as L,e as M,X as q,t as U,n as v,d as F,w as B,F as E,i as J,j as g,q as O,p as P}from"./index-BbgOGWtc.js";import{r as R}from"./request-BkFvJOBV.js";import{u as T}from"./adminStore-BUizldsK.js";import"./base-BBuVGrsO.js";import{E as b}from"./el-message-D3QXA0wy.js";import"./index-C6T8Vz6z.js";import"./aria-Dcom87Zv.js";import"./use-global-config-BqmYTjt1.js";const z={class:"login-card"},j={class:"input-box flex-item"},W={class:"input-box flex-item"},X=["type"],G={class:"flex-item"},H={class:"filter flex-item"},K=["disabled"],Q={__name:"Login",props:{redirect:{type:String,default:"/"}},setup(Y){const w=O(),x=P(),p=N(),y=T(),l=a(""),n=a(""),u=a(!1),r=a(!1),c=a(!1),d=a(!1),S=()=>{c.value=n.value.trim()!==""},h=()=>{d.value=!d.value},I=localStorage.getItem("isAuthenticated"),_=()=>{if(I){const o=JSON.parse(localStorage.getItem("user"));o!=null&&o.phone&&(l.value=o.phone),u.value=!0}},k=async()=>{var o,e;if(!r.value){r.value=!0;try{const t=await R({method:"post",url:"/api/login",params:{phone:l.value,password:n.value}});console.log(t),t!=null&&t.success&&(b.success("登录成功"),x.push({path:w.query.redirect||"/"}),u.value&&(localStorage.setItem("isAuthenticated","true"),localStorage.setItem("user",JSON.stringify(t.user))),p.login({id:Date.now(),phone:l.value,password:n.value,avatar:"../../assets/local_img/default_avatar_img/default-avatar.png",regDate:new Date().toLocaleString(),isAdmin:!1,roles:["user"]}),localStorage.setItem("auth",JSON.stringify(p.userInfo)),p.userInfo.phone||y.recordNewUsers({phone:t.phone,isAdmin:t.isAdmin||!1,role:t.role||"user",loginTime:new Date().toLocaleString()}))}catch(t){console.log("登录失败:",t),b.error(((e=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:e.message)||"登录失败, 请检查账号或密码")}finally{r.value=!1}}};return(o,e)=>{const t=J("router-link");return g(),f(E,null,[e[9]||(e[9]=s("div",{class:"login-container"},null,-1)),e[10]||(e[10]=s("div",{class:"login-card-out"},null,-1)),s("div",z,[e[8]||(e[8]=s("h2",null,"欢迎登录",-1)),s("form",{onSubmit:A(k,["prevent"])},[s("div",j,[m(s("input",{required:"","onUpdate:modelValue":e[0]||(e[0]=i=>l.value=i),onFocus:_},null,544),[[D,l.value]]),e[3]||(e[3]=s("span",null,"请输入账号",-1))]),s("div",W,[m(s("input",{type:d.value?"text":"password",required:"","onUpdate:modelValue":e[1]||(e[1]=i=>n.value=i),onInput:S},null,40,X),[[C,n.value]]),c.value?(g(),f("i",{key:0,onClick:h,class:L(d.value?"fas fa-eye-slash":"fas fa-eye")},null,2)):M("",!0),e[4]||(e[4]=s("span",null,"请输入密码",-1))]),s("div",G,[m(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=i=>u.value=i),id:"checkbox"},null,512),[[q,u.value]]),e[5]||(e[5]=s("label",{for:"checkbox",class:"checkbox"},"记住密码",-1))]),s("div",H,[s("button",{class:"login-button",disabled:r.value,type:"submit"},U(r.value?"登录中...":"登录"),9,K)])],32),s("span",null,[e[7]||(e[7]=v("没有账号？ ")),F(t,{to:"/Register"},{default:B(()=>e[6]||(e[6]=[v("去注册")])),_:1})])])],64)}}},ne=V(Q,[["__scopeId","data-v-2b3abdbe"]]);export{ne as default};
